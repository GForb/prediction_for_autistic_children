---
title: "Document"
params: 
    data: "R scripts/Data Processing/import_gui.R"  #"Path/to/data/as_string"
    name_dataset: "gui_data"  #"Robject as string"
    variables: c("age", "gender", "sdq_emot_p", "sdq_cond_p", "sdq_hyp_p", "sdq_peer_p", "sdq_pro_p") 
    colour: "red" #"name of colour"
editor: visual
execute: 
  echo: false
  warning: false
---

```{r}
 #| warning: false 
library(tidyverse) #c("A vector", "of strings")
library(here) 
library(ggplot2) 
library(haven) 
library(gridExtra) 
library(ggdist) 
library(ggthemes) 
library(gifski) 
library(magick) 
library(gt) 
library(gtExtras)

source(here::here("R scripts/set_paths.R")) 
source(here::here(params$data)) 
source(here::here("R scripts/Functions/raincloudplot.R")) 
source(here::here("R scripts/Functions/summary_functions.R")) 
source(here::here("R scripts/Functions/gif.R"))
set_name <- as.name(params$name_dataset)
waves <- max(get(set_name)[["wave"]])
```

Summary table

```{r}
#| warning: false

make_summary_table(get(set_name)) |> 
  filter(name %in% params$variables)|> 
  gt() |> 
  gt_theme_espn()
```

Summary tables by wave

```{r}
#| warning: false
for (wav in 1:waves) {
  wave <- make_summary_by_wave(get(set_name), waves)
  wave <- wave[[wav]] |> 
    filter(name %in% params$variables) |> 
    gt() |> 
    gt_theme_espn()
}

```

Plots:

```{r}
#| warning: false
for (variable in params$variables) {
  x <- make_raincloudplot(get(set_name)[[variable]], paste(variable, "score"), params$colour)
  show(x)
  y <- make_summary_table(get(set_name)) |> 
    filter(name == variable) |> 
    gt() |> 
    gt_theme_espn()
  show(y)
}
```

GIFs:

```{r}
#| warning: false
for (variable in params$variables) {
  gif <- make_raincloudplot_wave(get(set_name), waves, variable, paste(variable, "score by wave"), params$colour)
  create_gif(gif)
  for (wav in 1:waves) {
  first <- make_summary_by_wave(get(set_name), waves)
  first[[wav]] |> 
    filter(name == variable) |> 
    gt() |> 
    tab_header(paste("Wave:", wav)) |> 
    gt_theme_espn()
  }
}
```
